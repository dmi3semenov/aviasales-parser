# Aviasales Parser — Парсер билетов для отпуска

## Что это
Парсер Aviasales для поиска билетов. **Легко адаптируется под любой маршрут.**

## Текущий маршрут (можно изменить)
- **Маршрут:** Москва → Дубай → Маврикий → Москва
- **Критерии:** первые два перелёта прямые, обратный может быть с 1 пересадкой

### Как изменить маршрут
Просто скажи Claude новые параметры:
- Новый маршрут (города)
- Критерии (какие перелёты прямые, какие с пересадками)
- Сколько ночей в каждом месте

Claude адаптирует скрипт под новый маршрут.

## Структура проекта
```
├── aviasales-parser.js   # Основной парсер
├── merge-summaries.js    # Объединение сводок
├── generate-trips.js     # Генератор комбинаций дат
├── trip-config.json      # Параметры поездки
├── CLAUDE.md             # Этот файл (читается автоматически)
├── package.json          # Зависимости (playwright, xlsx)
└── output/               # ВСЕ ВЫГРУЗКИ ЗДЕСЬ
    ├── as_*.xlsx         # Excel файлы
    ├── as_*.json         # JSON данные
    ├── as_*.png          # Скриншоты
    └── as_СВОДКИ_*.xlsx  # Объединённые сводки
```

## Быстрый старт

### 1. Показать комбинации дат
```bash
node generate-trips.js
```

### 2. Запустить парсинг (пример для 4 дат)
```bash
node aviasales-parser.js \
  "https://www.aviasales.ru/search/MOW2002DXB2402MRU0303MOW2" \
  "https://www.aviasales.ru/search/MOW2102DXB2502MRU0403MOW2" \
  "https://www.aviasales.ru/search/MOW2202DXB2602MRU0503MOW2" \
  "https://www.aviasales.ru/search/MOW2302DXB2702MRU0603MOW2"
```

### 3. Объединить сводки (если нужно отдельно)
```bash
node merge-summaries.js
```

## Формат URL Aviasales
```
MOW2002DXB2402MRU0303MOW2
│  │   │  │   │  │   │
│  │   │  │   │  │   └── кол-во пассажиров
│  │   │  │   │  └────── дата вылета MRU (DDMM)
│  │   │  │   └───────── город 3
│  │   │  └───────────── дата вылета DXB (DDMM)
│  │   └──────────────── город 2
│  └──────────────────── дата вылета MOW (DDMM)
└─────────────────────── город 1
```

## Расчёт ночей
- **Вылет MOW 20.02** → прилёт DXB 20.02 (тот же день)
- **4 ночи в Дубае**: 20, 21, 22, 23 → вылет DXB 24.02
- **Прилёт MRU 24.02** (тот же день)
- **7 ночей на Маврикии**: 24-28 фев + 1-2 мар → вылет MRU 3.03
- **Прилёт MOW 4.03** (следующий день)

## Формат имени файла
```
as_2002-2402-0303_MOW-DXB-MRU_02-13_19-26.xlsx
│  │              │           │     │
│  │              │           │     └── время (HH-MM)
│  │              │           └──────── дата (MM-DD)
│  │              └──────────────────── маршрут
│  └─────────────────────────────────── даты (DDMM-DDMM-DDMM)
└────────────────────────────────────── префикс (aviasales)
```

## Критерии фильтрации
- MOW→DXB: **прямой рейс** (обязательно)
- DXB→MRU: **прямой рейс** (обязательно)
- MRU→MOW: **прямой или 1 пересадка** (допустимо)

## Таблица валидации (показывать перед запуском)
```
| № | Вылет MOW | Вылет DXB→MRU | Вылет MRU | Прилёт MOW | Дубай | Маврикий |
|---|-----------|---------------|-----------|------------|-------|----------|
| 1 | 20.02     | 24.02         | 3.03      | 4.03       | 4н    | 7н       |
```

## Важно помнить
- После парсинга нескольких URL — автоматически создаётся общая сводка
- Все файлы сохраняются в папку `output/`
- В сводке показывать только подходящие варианты (с галочкой ✓)

## Текущие параметры поездки
См. `trip-config.json`
